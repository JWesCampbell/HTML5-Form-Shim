

var hfFormShim=function(global,factory){"use strict";if(typeof define==="function"&&define.amd){define(function(require,exports,module){return factory(exports)})}else if(typeof exports!=="undefined"){return factory(exports)}else{return factory({})}}(this,function(exports){"use strict";exports.version="2.1.1-dev";return function(global,undefined){var $=function(global){if(global.jQuery===undefined){throw new ReferenceError("jQuery is required")}return global.jQuery}(global),document=global.document,composite=null,ONINPUT_DELAY=500,util={createInstance:function(module,args){var key,instance,members=module.apply(module.prototype,args||[])||{},Fn=function(){};if(members.hasOwnProperty("__extends__")&&members.__extends__){module.prototype=util.createInstance(members.__extends__,args)}Fn.prototype=module.prototype;for(key in members){if(members.hasOwnProperty(key)){Fn.prototype[key]=members[key]}}instance=new Fn;members.hasOwnProperty("__constructor__")&&members.__constructor__.apply(instance,args||[]);return instance},onDomReady:function(fn){if(typeof define==="function"&&define.amd){require(["domReady"],function(domReady){domReady(fn)})}else{$(document).ready(fn)}},isString:function(value){return typeof value==="string"&&isNaN(value)},isNumber:function(value){return!isNaN(parseFloat(value))&&isFinite(value)},ucfirst:function(str){str+="";return str.charAt(0).toUpperCase()+str.substr(1).toLowerCase()}},modernizr={supportedInputTypes:function(){var inputElem=document.createElement("input"),types=function(props){for(var i=0,types=[],len=props.length;i<len;i++){inputElem.setAttribute("type",props[i]);types[props[i]]=inputElem.type!=="text"}return types}("search tel url email datetime date month week time datetime-local number range color".split(" "));return types}(),supportedInputProps:function(){var inputElem=document.createElement("input"),attrs=function(props){for(var i=0,attrs=[],len=props.length;i<len;i++){attrs[props[i]]=!!(props[i]in inputElem)}return attrs}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" "));return attrs}()},Page=function(){var forms=[];return{__constructor__:function(){$("form[data-enable-shim='true']").each(function(){forms.push(util.createInstance(Form,[{boundingBox:$(this)}]))})},getInput:function(node){var $node=$(node),input;for(var i in forms){if(input=forms[i].getInput($node)){return input}}return null}}},Form=function(){return{boundingBox:null,inputs:{},options:{boundingBox:null,inputs:"input, textarea",handlers:{onSubmit:function(){}}},valid:true,__constructor__:function(options){var that=this;if(!options.boundingBox){throw new Error("Options property boundingBox undefined")}this.boundingBox=options.boundingBox;$.extend(this.options,options);this.inputs=[];if(this.isCustomValidation()){this.boundingBox.attr("novalidate","novalidate")}this.shimFormAttrMutators();this.initInputs();this.boundingBox.on("submit",function(e){that.handleOnSubmit(e)})},getLocalId:function($node){var localId=$node.data("local-id")||Page.incrementor++;$node.data("local-id",Page.incrementor);return localId},getInput:function(node){var $node=$(node),localId=this.getLocalId($node);return this.inputs[localId]||null},initInputs:function(){var that=this;this.boundingBox.find(this.options.inputs).each(function(){var $node=$(this),localId=that.getLocalId($node),instance=that.inputFactory($node);if(instance!==false){that.inputs[localId]=instance}})},shimFormAttrMutators:function(){var that=this;this.boundingBox.find("input, button").each(function(){$(this).attr("formaction")&&$(this).on("click",function(){that.boundingBox.attr("action",$(this).attr("formaction"))});$(this).attr("formenctype")&&$(this).on("click",function(){that.boundingBox.attr("enctype",$(this).attr("formenctype"))});$(this).attr("formmethod")&&$(this).on("click",function(){that.boundingBox.attr("method",$(this).attr("formmethod"))});$(this).attr("formtarget")&&$(this).on("click",function(){that.boundingBox.attr("target",$(this).attr("formtarget"))})})},isCustomValidation:function(){return this.boundingBox.data("custom-validation")!==undefined},isNoValidate:function(){return this.boundingBox.attr("novalidate")!==undefined},setValid:function(){this.valid=true;this.boundingBox.addClass("valid").removeClass("invalid")},setInvalid:function(){this.valid=false;this.boundingBox.addClass("invalid").removeClass("valid")},inputFactory:function(element){var type=util.ucfirst(element.data("type")||element.attr("type"));return util.createInstance(Input[type]||Input.Text,[element,this.isCustomValidation()])},handleOnSubmit:function(e){var isValid=true;if(!this.inputs){return}for(var i in this.inputs){if(this.inputs.hasOwnProperty(i)){var input=this.inputs[i];input.resetValidationState();if(input.isShimRequired()){input.checkValidity();input.updateState();if(!input.validity.valid){if(input.validationMessageNode){input.showValidationMessage()}else{isValid&&input.showTooltip()}isValid=false}}}}this.options.handlers.onSubmit();if(isValid){this.setValid()}else{this.setInvalid();e.preventDefault()}}}},ValidityDefaultStateVo=function(){return{valueMissing:false,typeMismatch:false,patternMismatch:false,tooLong:false,rangeUnderflow:false,rangeOverflow:false,stepMismatch:false,badInput:false,customError:false,valid:true}},AbstractInput=function(){return{boundingBox:null,defaultValidationMessages:{valueMissing:"Please fill out this field",typeMismatch:"",patternMismatch:"The pattern is mismatched",rangeUnderflow:"The value is too low",rangeOverflow:"The value is too high",tooLong:"The value is too long",stepMismatch:"Invalid step for the range",badInput:"The user agent is unable to convert to a value",customError:""},validity:new ValidityDefaultStateVo,validationMessage:"",validationMessageNode:null,deferredRequest:null,forceShim:false,__constructor__:function(boundingBox,forceShim){var that=this;this.boundingBox=boundingBox;this.forceShim=!!forceShim;this.boundingBox.removeClass("valid invalid");this.boundingBox.checkValidity=function(){return that.checkValidity()};this.shimSetCustomValidity();this.lookForValidationMessageNode();if(this.forceShim||!modernizr.supportedInputProps.placeholder){this.shimPlaceholder()}if(this.forceShim||!modernizr.supportedInputProps.required){this.shimRequired()}if(this.forceShim||!modernizr.supportedInputProps.autofocus){this.shimFocusPseudoClass();this.shimAutofocus()}if(this.boundingBox.data("custom-validation")){this.boundingBox.attr("novalidate","novalidate")}if(this.isShimRequired()){this.shimOnInput()}},val:function(val){return val!==undefined?this.boundingBox=val:this.boundingBox},degrade:function(){this.boundingBox.get(0).type="text";return this},shimSetCustomValidity:function(){this.boundingBox.get(0).setCustomValidity=$.fn.setCustomValidity;this.boundingBox.get(0).setCustomValidity=function(msg){msg&&this.throwValidationException("customError",msg);this.boundingBox.get(0).setCustomValidity(msg)}},isShimRequired:function(){return this.forceShim||!modernizr.supportedInputTypes[this.boundingBox.attr("type")]||this.boundingBox.data("custom-validation")},checkValidity:function(){this.validateRequired();this.checkValidityWithoutRequired();return this.validity.valid},checkValidityWithoutRequired:function(){this.validateValue&&this.validateValue();this.validateByPattern();this.validateCustomValidity()},lookForValidationMessageNode:function(){var id,$hint;if(id=this.boundingBox.attr("id")){$hint=$("form *[data-validation-message-for="+id+"]");this.validationMessageNode=$hint.length?$hint:null}},showValidationMessage:function(){var msg=this.validationMessage;this.validationMessageNode.html(msg);this.validationMessageNode[msg?"show":"hide"]()},shimOnInput:function(){var that=this;this.boundingBox.on("change mouseup keydown",function(){that.handleOnInput()})},resetValidationState:function(){this.validity=new ValidityDefaultStateVo;this.validationMessage="";this.validationMessageNode&&this.showValidationMessage()},handleOnInput:function(){var that=this;if(null!==this.deferredRequest){global.clearTimeout(this.deferredRequest)}this.deferredRequest=global.setTimeout(function(){that.resetValidationState();that.deferredRequest=null;that.invokeOnInputCallBack();that.boundingBox.trigger("oninput",that);that.checkValidityWithoutRequired();that.updateState();that.validationMessageNode&&that.showValidationMessage()},ONINPUT_DELAY)},invokeOnInputCallBack:function(){var callbackKey,pos;if(this.boundingBox.attr("oninput")!==undefined){callbackKey=this.boundingBox.attr("oninput");pos=callbackKey.indexOf("(");callbackKey=pos?callbackKey.substr(0,pos):callbackKey;if(typeof global[callbackKey]){global[callbackKey](this.boundingBox)}}},handleOnFocus:function(){if(this.boundingBox.val()===this.boundingBox.attr("placeholder")){this.boundingBox.val("");this.boundingBox.removeClass("placeholder")}},handleOnBlur:function(){if(!this.boundingBox.val()){this.boundingBox.val(this.boundingBox.attr("placeholder"));this.boundingBox.addClass("placeholder")}},validateCustomValidity:function(){if(this.boundingBox.data("customvalidity")){this.throwValidationException("customError",this.boundingBox.data("customvalidity"));return false}return true},shimRequired:function(){this.boundingBox.attr("required")===undefined||this.boundingBox.addClass("required").data("custom-validation","true")},shimFocusPseudoClass:function(){var that=this;this.boundingBox.on("focus",function(){that.boundingBox.addClass("focus")}).on("blur",function(){that.boundingBox.removeClass("focus")})},shimAutofocus:function(){if(this.boundingBox.attr("autofocus")!==undefined){this.boundingBox.focus();this.handleOnFocus()}},shimPlaceholder:function(){var that=this;if(this.boundingBox.attr("placeholder")!==undefined){this.boundingBox.attr("autocomplete","false");this.handleOnBlur();this.boundingBox.on("focusin",function(){that.handleOnFocus()}).on("focusout",function(){that.handleOnBlur()})}},throwValidationException:function(prop,validationMessage){if(this.validity[prop]===undefined){throw new SyntaxError("Invalid validity property '"+prop+"'")}this.validity[prop]=true;this.validity.valid=false;this.validationMessage=validationMessage||this.defaultValidationMessages[prop];this.shimConstraintValidationApi()},shimConstraintValidationApi:function(){var node=this.boundingBox.get(0);try{node.validity=this.validity}catch(err){}},validateByPattern:function(){if(!this.boundingBox.attr("pattern")){return true}var pattern=new RegExp(this.boundingBox.attr("pattern"),"g");pattern.test(this.boundingBox.val())||this.throwValidationException("patternMismatch",this.boundingBox.attr("title")||null)},validateRequired:function(){if(this.boundingBox.hasClass("required")&&(this.boundingBox.val()===this.boundingBox.attr("placeholder")||!this.boundingBox.val())){this.throwValidationException("valueMissing")}},updateState:function(){var state=this.validity.valid?"valid":"invalid";this.boundingBox.removeClass("valid invalid").addClass(state);return state},showTooltip:function(msg){$.setCustomValidityCallback.apply(this.boundingBox,[msg||this.validationMessage])}}},Input={Text:function(){return{__extends__:AbstractInput}},Tel:function(){return{__extends__:AbstractInput,__constructor__:function(){this.degrade()},validateValue:function(){var pattern=/^\+(?:[0-9] ?){6,14}[0-9]$/;pattern.test(this.boundingBox.val())||this.throwValidationException("typeMismatch","Please enter a valid tel. number +1 11 11 11")}}},Email:function(){return{__extends__:AbstractInput,__constructor__:function(){this.degrade()},validateValue:function(){var pattern=/^[a-zA-Z0-9._\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,4}$/g;pattern.test(this.boundingBox.val())||this.throwValidationException("typeMismatch","Please enter a valid email address")}}},Number:function(){return{__extends__:AbstractInput,__constructor__:function(){this.degrade()},validateValue:function(){util.isNumber(parseInt(this.boundingBox.val(),10))||this.throwValidationException("typeMismatch","Please enter a valid number");this.boundingBox.attr("min")&&parseInt(this.boundingBox.val(),10)<parseInt(this.boundingBox.attr("min"),10)&&this.throwValidationException("rangeUnderflow");this.boundingBox.attr("max")&&parseInt(this.boundingBox.val(),10)>parseInt(this.boundingBox.attr("max"),10)&&this.throwValidationException("rangeOverflow")}}},Url:function(){return{__extends__:AbstractInput,__constructor__:function(){this.degrade()},validateValue:function(){var pattern=/^(https?:\/\/)?((([a-z\d]([a-z\d\-]*[a-z\d])*)\.)+[a-z]{2,}|((\d{1,3}\.){3}\d{1,3}))(\:\d+)?(\/[\-a-z\d%_.~+]*)*(\?[;&a-z\d%_.~+=\-]*)?(\#[\-a-z\d_]*)?$/i;pattern.test(this.boundingBox.val())||this.throwValidationException("typeMismatch","Please enter a valid URL")}}}};Page.incrementor=0;$.setCustomInputTypeValidator=function(type,msg,validatorCb,initCb){Input[util.ucfirst(type)]=function(){return{__extends__:AbstractInput,__constructor__:function(){initCb&&initCb.apply(this.boundingBox,[this])},validateValue:function(){validatorCb.apply(this.boundingBox,[this])||this.throwValidationException("customError",msg)}}}};$.setCustomValidityCallback=function(error){var pos=this.position(),tooltip=$('<div class="tooltip tooltip-e">'+'<div class="tooltip-arrow tooltip-arrow-e"></div>'+'<div class="tooltip-inner">'+error+"</div>"+"</div>").appendTo(this.parent());tooltip.css("top",pos.top-tooltip.height()/2+20);tooltip.css("left",pos.left-tooltip.width()-12);global.setTimeout(function(){tooltip.remove()},2500)};$.fn.setCustomValidity=function(message){$(this).each(function(inx,el){$(el).data("customvalidity",message)})};util.onDomReady(function(){composite=util.createInstance(Page)});return{init:function(options){if(options&&options.boundingBox&&options.boundingBox.length){composite=util.createInstance(Form,[options])}else{composite=util.createInstance(Page)}},getInput:function(node){return composite.getInput(node)},getTestable:function(){return{util:util,Input:Input}}}}(window)});
