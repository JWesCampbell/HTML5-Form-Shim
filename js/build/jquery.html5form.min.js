/*
 * @package HTML5 Form Shim
 * @author sheiko
 * @license MIT
 * @copyright (c) Dmitry Sheiko http://www.dsheiko.com
 * @jscs standard:Jquery
 * Code style: http://docs.jquery.com/JQuery_Core_Style_Guidelines
 *//*global define:false, exports:true, require: false, window:true *//** @constructor */var hfFormShim=function(e,t){"use strict";if(typeof define!="function"||!define.amd)return typeof exports!="undefined"?t(exports):t({});define(function(e,n,r){return t(n)})}(this,function(e){"use strict";return e.version="2.1.1-dev",function(e,t){var n=function(e){if(e.jQuery===t)throw new ReferenceError("jQuery is required");return e.jQuery}(e),r=e.document,i=null,s=500,o={createInstance:function(e,t){var n,r,i=e.apply(e.prototype,t||[])||{},s=function(){};i.hasOwnProperty("__extends__")&&i.__extends__&&(e.prototype=o.createInstance(i.__extends__,t)),s.prototype=e.prototype;for(n in i)i.hasOwnProperty(n)&&(s.prototype[n]=i[n]);return r=new s,i.hasOwnProperty("__constructor__")&&i.__constructor__.apply(r,t||[]),r},onDomReady:function(e){typeof define=="function"&&define.amd?require(["domReady"],function(t){t(e)}):n(r).ready(e)},isString:function(e){return typeof e=="string"&&isNaN(e)},isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},ucfirst:function(e){return e+="",e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}},u={supportedInputTypes:function(){var e=r.createElement("input"),t=function(t){for(var n=0,r=[],i=t.length;n<i;n++)e.setAttribute("type",t[n]),r[t[n]]=e.type!=="text";return r}("search tel url email datetime date month week time datetime-local number range color".split(" "));return t}(),supportedInputProps:function(){var e=r.createElement("input"),t=function(t){for(var n=0,r=[],i=t.length;n<i;n++)r[t[n]]=t[n]in e;return r}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" "));return t}()},a=function(){var e=[];return{__constructor__:function(){n("form[data-enable-shim='true']").each(function(){e.push(o.createInstance(f,[{boundingBox:n(this)}]))})},getInput:function(t){var r=n(t),i;for(var s in e)if(i=e[s].getInput(r))return i;return null}}},f=function(){return{boundingBox:null,inputs:{},options:{boundingBox:null,inputs:"input, textarea",handlers:{onSubmit:function(){}}},valid:!0,__constructor__:function(e){var t=this;if(!e.boundingBox)throw new Error("Options property boundingBox undefined");this.boundingBox=e.boundingBox,n.extend(this.options,e),this.inputs=[],this.isCustomValidation()&&this.boundingBox.attr("novalidate","novalidate"),this.shimFormAttrMutators(),this.initInputs(),this.boundingBox.on("submit",function(e){t.handleOnSubmit(e)})},getLocalId:function(e){var t=e.data("local-id")||a.incrementor++;return e.data("local-id",a.incrementor),t},getInput:function(e){var t=n(e),r=this.getLocalId(t);return this.inputs[r]||null},initInputs:function(){var e=this;this.boundingBox.find(this.options.inputs).each(function(){var t=n(this),r=e.getLocalId(t),i=e.inputFactory(t);i!==!1&&(e.inputs[r]=i)})},shimFormAttrMutators:function(){var e=this;this.boundingBox.find("input, button").each(function(){n(this).attr("formaction")&&n(this).on("click",function(){e.boundingBox.attr("action",n(this).attr("formaction"))}),n(this).attr("formenctype")&&n(this).on("click",function(){e.boundingBox.attr("enctype",n(this).attr("formenctype"))}),n(this).attr("formmethod")&&n(this).on("click",function(){e.boundingBox.attr("method",n(this).attr("formmethod"))}),n(this).attr("formtarget")&&n(this).on("click",function(){e.boundingBox.attr("target",n(this).attr("formtarget"))})})},isCustomValidation:function(){return this.boundingBox.data("custom-validation")!==t},isNoValidate:function(){return this.boundingBox.attr("novalidate")!==t},setValid:function(){this.valid=!0,this.boundingBox.addClass("valid").removeClass("invalid")},setInvalid:function(){this.valid=!1,this.boundingBox.addClass("invalid").removeClass("valid")},inputFactory:function(e){var t=o.ucfirst(e.data("type")||e.attr("type"));return o.createInstance(h[t]||h.Text,[e,this.isCustomValidation()])},handleOnSubmit:function(e){var t=!0;if(!this.inputs)return;for(var n in this.inputs)if(this.inputs.hasOwnProperty(n)){var r=this.inputs[n];r.resetValidationState(),r.isShimRequired()&&(r.checkValidity(),r.updateState(),r.validity.valid||(r.validationMessageNode?r.showValidationMessage():t&&r.showTooltip(),t=!1))}this.options.handlers.onSubmit(),t?this.setValid():(this.setInvalid(),e.preventDefault())}}},l=function(){return{valueMissing:!1,typeMismatch:!1,patternMismatch:!1,tooLong:!1,rangeUnderflow:!1,rangeOverflow:!1,stepMismatch:!1,badInput:!1,customError:!1,valid:!0}},c=function(){return{boundingBox:null,defaultValidationMessages:{valueMissing:"Please fill out this field",typeMismatch:"",patternMismatch:"The pattern is mismatched",rangeUnderflow:"The value is too low",rangeOverflow:"The value is too high",tooLong:"The value is too long",stepMismatch:"Invalid step for the range",badInput:"The user agent is unable to convert to a value",customError:""},validity:new l,validationMessage:"",validationMessageNode:null,deferredRequest:null,forceShim:!1,__constructor__:function(e,t){var n=this;this.boundingBox=e,this.forceShim=!!t,this.boundingBox.removeClass("valid invalid"),this.boundingBox.checkValidity=function(){return n.checkValidity()},this.shimSetCustomValidity(),this.lookForValidationMessageNode(),(this.forceShim||!u.supportedInputProps.placeholder)&&this.shimPlaceholder(),(this.forceShim||!u.supportedInputProps.required)&&this.shimRequired();if(this.forceShim||!u.supportedInputProps.autofocus)this.shimFocusPseudoClass(),this.shimAutofocus();this.boundingBox.data("custom-validation")&&this.boundingBox.attr("novalidate","novalidate"),this.isShimRequired()&&this.shimOnInput()},val:function(e){return e!==t?this.boundingBox=e:this.boundingBox},degrade:function(){return this.boundingBox.get(0).type="text",this},shimSetCustomValidity:function(){this.boundingBox.get(0).setCustomValidity=n.fn.setCustomValidity,this.boundingBox.get(0).setCustomValidity=function(e){e&&this.throwValidationException("customError",e),this.boundingBox.get(0).setCustomValidity(e)}},isShimRequired:function(){return this.forceShim||!u.supportedInputTypes[this.boundingBox.attr("type")]||this.boundingBox.data("custom-validation")},checkValidity:function(){return this.validateRequired(),this.checkValidityWithoutRequired(),this.validity.valid},checkValidityWithoutRequired:function(){this.validateValue&&this.validateValue(),this.validateByPattern(),this.validateCustomValidity()},lookForValidationMessageNode:function(){var e,t;if(e=this.boundingBox.attr("id"))t=n("form *[data-validation-message-for="+e+"]"),this.validationMessageNode=t.length?t:null},showValidationMessage:function(){var e=this.validationMessage;this.validationMessageNode.html(e),this.validationMessageNode[e?"show":"hide"]()},shimOnInput:function(){var e=this;this.boundingBox.on("change mouseup keydown",function(){e.handleOnInput()})},resetValidationState:function(){this.validity=new l,this.validationMessage="",this.validationMessageNode&&this.showValidationMessage()},handleOnInput:function(){var t=this;null!==this.deferredRequest&&e.clearTimeout(this.deferredRequest),this.deferredRequest=e.setTimeout(function(){t.resetValidationState(),t.deferredRequest=null,t.invokeOnInputCallBack(),t.boundingBox.trigger("oninput",t),t.checkValidityWithoutRequired(),t.updateState(),t.validationMessageNode&&t.showValidationMessage()},s)},invokeOnInputCallBack:function(){var n,r;this.boundingBox.attr("oninput")!==t&&(n=this.boundingBox.attr("oninput"),r=n.indexOf("("),n=r?n.substr(0,r):n,typeof e[n]&&e[n](this.boundingBox))},handleOnFocus:function(){this.boundingBox.val()===this.boundingBox.attr("placeholder")&&(this.boundingBox.val(""),this.boundingBox.removeClass("placeholder"))},handleOnBlur:function(){this.boundingBox.val()||(this.boundingBox.val(this.boundingBox.attr("placeholder")),this.boundingBox.addClass("placeholder"))},validateCustomValidity:function(){return this.boundingBox.data("customvalidity")?(this.throwValidationException("customError",this.boundingBox.data("customvalidity")),!1):!0},shimRequired:function(){this.boundingBox.attr("required")===t||this.boundingBox.addClass("required").data("custom-validation","true")},shimFocusPseudoClass:function(){var e=this;this.boundingBox.on("focus",function(){e.boundingBox.addClass("focus")}).on("blur",function(){e.boundingBox.removeClass("focus")})},shimAutofocus:function(){this.boundingBox.attr("autofocus")!==t&&(this.boundingBox.focus(),this.handleOnFocus())},shimPlaceholder:function(){var e=this;this.boundingBox.attr("placeholder")!==t&&(this.boundingBox.attr("autocomplete","false"),this.handleOnBlur(),this.boundingBox.on("focusin",function(){e.handleOnFocus()}).on("focusout",function(){e.handleOnBlur()}))},throwValidationException:function(e,n){if(this.validity[e]===t)throw new SyntaxError("Invalid validity property '"+e+"'");this.validity[e]=!0,this.validity.valid=!1,this.validationMessage=n||this.defaultValidationMessages[e],this.shimConstraintValidationApi()},shimConstraintValidationApi:function(){var e=this.boundingBox.get(0);try{e.validity=this.validity}catch(t){}},validateByPattern:function(){if(!this.boundingBox.attr("pattern"))return!0;var e=new RegExp(this.boundingBox.attr("pattern"),"g");e.test(this.boundingBox.val())||this.throwValidationException("patternMismatch",this.boundingBox.attr("title")||null)},validateRequired:function(){this.boundingBox.hasClass("required")&&(this.boundingBox.val()===this.boundingBox.attr("placeholder")||!this.boundingBox.val())&&this.throwValidationException("valueMissing")},updateState:function(){var e=this.validity.valid?"valid":"invalid";return this.boundingBox.removeClass("valid invalid").addClass(e),e},showTooltip:function(e){n.setCustomValidityCallback.apply(this.boundingBox,[e||this.validationMessage])}}},h={Text:function(){return{__extends__:c}},Tel:function(){return{__extends__:c,__constructor__:function(){this.degrade()},validateValue:function(){var e=/^\+(?:[0-9] ?){6,14}[0-9]$/;e.test(this.boundingBox.val())||this.throwValidationException("typeMismatch","Please enter a valid tel. number +1 11 11 11")}}},Email:function(){return{__extends__:c,__constructor__:function(){this.degrade()},validateValue:function(){var e=/^[a-zA-Z0-9._\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,4}$/g;e.test(this.boundingBox.val())||this.throwValidationException("typeMismatch","Please enter a valid email address")}}},Number:function(){return{__extends__:c,__constructor__:function(){this.degrade()},validateValue:function(){o.isNumber(parseInt(this.boundingBox.val(),10))||this.throwValidationException("typeMismatch","Please enter a valid number"),this.boundingBox.attr("min")&&parseInt(this.boundingBox.val(),10)<parseInt(this.boundingBox.attr("min"),10)&&this.throwValidationException("rangeUnderflow"),this.boundingBox.attr("max")&&parseInt(this.boundingBox.val(),10)>parseInt(this.boundingBox.attr("max"),10)&&this.throwValidationException("rangeOverflow")}}},Url:function(){return{__extends__:c,__constructor__:function(){this.degrade()},validateValue:function(){var e=/^(https?:\/\/)?((([a-z\d]([a-z\d\-]*[a-z\d])*)\.)+[a-z]{2,}|((\d{1,3}\.){3}\d{1,3}))(\:\d+)?(\/[\-a-z\d%_.~+]*)*(\?[;&a-z\d%_.~+=\-]*)?(\#[\-a-z\d_]*)?$/i;e.test(this.boundingBox.val())||this.throwValidationException("typeMismatch","Please enter a valid URL")}}}};return a.incrementor=0,n.setCustomInputTypeValidator=function(e,t,n,r){h[o.ucfirst(e)]=function(){return{__extends__:c,__constructor__:function(){r&&r.apply(this.boundingBox,[this])},validateValue:function(){n.apply(this.boundingBox,[this])||this.throwValidationException("customError",t)}}}},n.setCustomValidityCallback=function(t){var r=this.position(),i=n('<div class="tooltip tooltip-e"><div class="tooltip-arrow tooltip-arrow-e"></div><div class="tooltip-inner">'+t+"</div>"+"</div>").appendTo(this.parent());i.css("top",r.top-i.height()/2+20),i.css("left",r.left-i.width()-12),e.setTimeout(function(){i.remove()},2500)},n.fn.setCustomValidity=function(e){n(this).each(function(t,r){n(r).data("customvalidity",e)})},o.onDomReady(function(){i=o.createInstance(a)}),{init:function(e){e&&e.boundingBox&&e.boundingBox.length?i=o.createInstance(f,[e]):i=o.createInstance(a)},getInput:function(e){return i.getInput(e)},getTestable:function(){return{util:o,Input:h}}}}(window)});